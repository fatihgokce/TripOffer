<!DOCTYPE html>
<!--
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership.  The ASF licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License.  You may obtain a copy of the License at
 
 http://www.apache.org/licenses/LICENSE-2.0
 
 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied.  See the License for the
 specific language governing permissions and limitations
 under the License.
 -->
<html ng-app="ionicApp">

<head>
    <!--
         Customize this policy to fit your own app's needs. For more guidance, see:
         https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
         Some notes:
         * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
         * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
         * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
         * Enable inline JS: add 'unsafe-inline' to default-src
         -->
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <link rel="stylesheet" type="text/css" href="css/index.css?v=1.2">
    <title>Tripper</title>
    <link href="css/ionic.css" rel="stylesheet">
    <link href="css/ionicons.min.css" rel="stylesheet">

    <script src="js/ionic.bundle.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="js/markerwithlabel.js"></script>
    <script src="js/app.js"></script>
    <script src="directive/ionicSelectDirective.js"></script>
    <script src="js/jquery.min.js"></script>

    <style>
        @font-face {
            font-family: 'arial';
            src: url('fonts/arial.ttf');
            /* IE9 Compat Modes */
            src: url('fonts/arial.ttf') format('woff2'), /* Super Modern Browsers */
            url('fonts/arial.ttf') format('woff'), /* Pretty Modern Browsers */
            url('fonts/arial.ttf') format('truetype')/* Safari, Android, iOS */
        }
        
        @font-face {
            font-family: 'billabong';
            src: url('fonts/Billabong.ttf');
            /* IE9 Compat Modes */
            src: url('fonts/Billabong.ttf') format('woff2'), /* Super Modern Browsers */
            url('fonts/Billabong.ttf') format('woff'), /* Pretty Modern Browsers */
            url('fonts/Billabong.ttf') format('truetype')/* Safari, Android, iOS */
        }
        
        @font-face {
            font-family: 'quicksand-Regular';
            src: url('fonts/Quicksand-Regular.ttf');
            /* IE9 Compat Modes */
            src: url('fonts/Quicksand-Regular.ttf') format('woff2'), /* Super Modern Browsers */
            url('fonts/Quicksand-Regular.ttf') format('woff'), /* Pretty Modern Browsers */
            url('fonts/Quicksand-Regular.ttf') format('truetype')/* Safari, Android, iOS */
        }
        
        @font-face {
            font-family: 'sourceSansPro-Regular';
            src: url('fonts/SourceSansPro-Regular.otf');
            /* IE9 Compat Modes */
            src: url('fonts/SourceSansPro-Regular.otf') format('woff2'), /* Super Modern Browsers */
            url('fonts/SourceSansPro-Regular.otf') format('woff'), /* Pretty Modern Browsers */
            url('fonts/SourceSansPro-Regular.otf') format('truetype')/* Safari, Android, iOS */
        }
        
        .inf-name {
            font-family: quicksand-Regular;
            font-size: 12px;
            color: black;
            line-height: 11px;
            font-weight: bold;
        }
        
        .main-label {
            font-family: quicksand-Regular;
            font-size: 18px;
            color: #fff;
        }
        
        #main_div select {
            width: 100%;
            background-color: transparent;
            border-color: transparent;
            color: #2E8DB2;
            font-family: quicksand-Regular;
            font-size: 16px;
        }
        
        #map,
        #map2 {
            width: 100%;
            height: 100%;
        }
        
        .scroll {
            height: 100%;
        }
        
        body {
            /* background: url(img/7.png);*/
            background-attachment: fixed;
            background-position: center;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            background-size: cover;
            color: #ffffff;
            background-color: #FF6207 !important;
        }
        
        .divider {
            background: url(img/devider.png) no-repeat;
            width: 100%;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            background-size: cover;
            height: 1px;
        }
        
        .background,
        .background .pane,
        .background .item,
        .background .item-complex .item-content {
            background-color: yellow !important;
        }
        
        .div_wrp {
            padding: 10px;
            margin: 10px 0 10px 0;
        }
        
        body .view-container.tab-content {
            background-color: transparent;
        }
        
        .pane {
            background-color: #96CEE4 !important;
            background: url(img/bg-01.png) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }
        
        .card {
            margin: : 10px !important;
        }
        
        .item-radio .item-content {
            padding: 0px;
            background: none;
        }
        
        .button-bar .button {
            min-height: 0;
            line-height: 30px;
        }
        
        .button-bar > .item-radio.button {
            padding: 0;
        }
        
        .item-radio input:checked ~ .item-content {
            /* style the item content when its checked */
            border-color: #145fd7;
            background-color: #4a87ee;
            color: white;
        }
        
        .item-radio .radio-icon {
            display: none;
        }
        
        .button.button-positive.button-outline.active,
        .button.button-positive.button-outline.activated {
            background-color: #2E8DB2;
            box-shadow: none;
            color: #fff;
        }
        
        .card .item:last-child,
        .list-inset .item:last-child {
            margin-bottom: 0;
        }
        
        .list {
            margin-bottom: 2px !important;
        }
        
        .item {
            padding: 12px !important;
        }
        
        .button.button-block,
        .button.button-full {
            margin-top: 1px !important;
            margin-bottom: 1px !important;
        }
        
        td,
        div {
            color: #000;
        }
        
        .labels {
            color: black;
            font-family: "Lucida Grande", "Arial", sans-serif;
            font-size: 10px;
            font-weight: bold;
            width: 80px;
            white-space: nowrap;
        }
        
        #ul_route li {
            padding: 3px;
            font-size: 20px;
            font-size: 17px;
        }
        
        .div_wrp select {
            -webkit-appearance: none;
            background: url(img/arrow.png) no-repeat right #BADA55;
        }
        
        .slider-wrapper {
            margin: 50px 0 30px 30px;
            position: relative;
            width: 250px;
        }
        
        .mynavbar {
            height: 36px !important;
            background-color: transparent !important;
            border-color: transparent !important;
        }
        
        .bb {
            position: relative;
            top: -5px;
            color: #fff !important;
        }
        
        .active-direct {
            color: #4285f4 !important;
        }
        
        .deactive-direct {
            color: #ccc !important;
        }
    </style>

    <script type="text/javascript" charset="utf-8">
        if (!String.prototype.with) {
            String.prototype.with = function () {
                var args = arguments;
                return this.replace(/{(\d+)}/g, function (match, number) {
                    return typeof args[number] != 'undefined' ? args[number] : match;
                });
            };
        }
        if (!Array.prototype.clear) {
            Array.prototype.clear = function () {
                this.splice(0, this.length);
            };
        }

        function setActive(ic) {
            $(".i-dircect").removeClass("active-direct").addClass("deactive-direct");
            $(ic).addClass("active-direct").removeClass("deactive-direct");
        }
        // Wait for device API libraries to load
        //
        //document.addEventListener("deviceready", onDeviceReady, false);

        // device APIs are available
        //
        function onDeviceReady() {
            //alert("ddd");
            // navigator.geolocation.getCurrentPosition(onSuccess, onError);
        }

        // onSuccess Geolocation
        //
        function onSuccess(position) {
            var element = document.getElementById('geolocation');
            element.innerHTML = 'Latitude: ' + position.coords.latitude + '<br />' +
                'Longitude: ' + position.coords.longitude + '<br />' +
                'Altitude: ' + position.coords.altitude + '<br />' +
                'Accuracy: ' + position.coords.accuracy + '<br />' +
                'Altitude Accuracy: ' + position.coords.altitudeAccuracy + '<br />' +
                'Heading: ' + position.coords.heading + '<br />' +
                'Speed: ' + position.coords.speed + '<br />' +
                'Timestamp: ' + position.timestamp + '<br />';
        }

        // onError Callback receives a PositionError object
        //
        function onError(error) {
            alert('code: ' + error.code + '\n' +
                'message: ' + error.message + '\n');
        }
    </script>

</head>

<body>

    <ion-nav-bar class="bar bar-stable mynavbar" align-title="center">
        <ion-nav-back-button class="button-icon ion-ios-arrow-back bb">
        </ion-nav-back-button>
    </ion-nav-bar>

    <ion-nav-view class="slide-left-right"></ion-nav-view>

    <script id="page2.html" type="text/ng-template">
        <!-- The title of the ion-view will be shown on the navbar -->
        <ion-view title="">
            <ion-nav-buttons side="left">

            </ion-nav-buttons>
            <!--      <ion-nav-buttons side="left">
            <a ng-click="centerOnMe()" class="button button-icon ion-ios-location-outline">
            
            Trip Path</a>
            </ion-nav-buttons>
            -->

            <ion-content class="padding">
                <!-- The content of the page -->
                <div id="map" data-tap-disabled="true"></div>
            </ion-content>
        </ion-view>
    </script>

    <script id="page3.html" type="text/ng-template">
        <!-- The title of the ion-view will be shown on the navbar -->
        <ion-view title="">
            <ion-nav-buttons side="left">

            </ion-nav-buttons>

            <ion-content class="padding">
                <div style=" width:100%;
            display: table;color:#FFF;
            " id="loading">
                    <ion-spinner icon="spiral" style="text-align:center;vertical-align:middle;color:#FFF"></ion-spinner>
                </div>

                <div ng-repeat="chat in lists">
                    <div style="border-bottom: 1px solid #ccc;padding:5px">
                        <div style="float:left">
                            <div style="display:inline-block;position: relative;">
                                <div style=""> <span style="color: #fff;font-family: quicksand-Regular;font-size: 16px;">
            {{chat.name}}
            </span></div>
                                <div style="    padding: 5px 2px 2px 0px;">
                                    <span style="color:#0a9dc7">
            <img src="img/{{chat.categoryName}}.png" width="24px" height="24px"/></span>
                                    <span style="color: #BFCAC2;
            font-size: 13px;
            position: relative;
            top: -5px;font-family:quicksand-Regular;">
            {{chat.location.distance}} m
            </span>
                                </div>
                                <span class="map-icon map-icon-bicycle-store"></span>
                            </div>
                        </div>
                        <div style="float:right">
                            <label class="checkbox">
                                <div style="display:inline-block">
                                    <input type="checkbox" id="{{chat.id}}" checked="checked" name="ckbVanue"> </div>
                            </label>
                        </div>
                        <div style="clear:both"></div>
                    </div>
                </div>
                <div style="backgroun-color:transparent">
                    <p ng-if="lists.length == 0" class="" style="
    text-align: center;
    color: #fff;
    font-family: arial;
    width: 100%;
    vertical-align: middle;
">
                        There is no place near to you please widen your distance .
                    </p>
                </div>
                <div style="clear:both"></div>
                <div style="margin-top:30px;margin-bottom:10px">
                    <button class="button button-energized button-block icon ion-ios-location-outline" style="font-family: quicksand-Regular;background-color:transparent;border-width:1px;border-radius:30px;border: 1px solid #ccc;" ng-click="showonMap()">&nbsp;&nbsp;Show on Map</button>
                </div>

                </div>
            </ion-content>
        </ion-view>
    </script>


    <!--    
     <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
        <script src="js/index.js"></script>
     -->

    <script>
        var map;
        var directionsDisplay;
        var markers = [];
        var rmarker = [];
        var lists = [];
        var mapLists = [];
        var currentLines;
        var ff;
        var currentPos;
        var myInter;
        var mapIcons = {
            "Historic": "map-icon map-icon-campground",
            "Food": "map-icon-food",
            "Fun": "map-icon-abseiling"
        };

        function getParam(name) {
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            var regexS = "[\\?&]" + name + "=([^&#]*)";
            var regex = new RegExp(regexS);
            var results = regex.exec(window.location.href);
            if (results == null)
                return "";
            else
                return results[1];
        }

        function setRoute(ind) {
            if (directionsDisplay)
                directionsDisplay.setMap(null);

            directionsDisplay = new google.maps.DirectionsRenderer({
                suppressMarkers: true
            });
            var directionsService = new google.maps.DirectionsService;
            directionsDisplay.setMap(map);
            var mode = $('.active-direct').attr("mode"); //'DRIVING'; //'WALKING';
            directionsService.route({
                origin: {
                    lat: currentPos.lat(),
                    lng: currentPos.lng()
                }, // Haight.
                destination: {
                    lat: mapLists[ind].location.lat,
                    lng: mapLists[ind].location.lng
                }, // Ocean Beach.
                // Note that Javascript allows us to access the constant
                // using square brackets and a string value as its
                // "property."
                travelMode: google.maps.TravelMode[mode] //google.maps.TravelMode.WALKING
            }, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                    myInter = setInterval(function () {
                        navigator.geolocation.getCurrentPosition(function (pos) {

                            var ll = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                            currentPos = ll;

                            var cc = rmarker.map(function (km) {
                                if (km.name == "You are here") return km
                            })[0];
                            if (cc) {
                                if (cc.position.lat() != ll.lat() || cc.position.lng() != ll.lng()) {
                                    if (pos.coords.speed > 0) {
                                        cc.setPosition(currentPos);
                                        map.setCenter(ll);
                                    }
                                }
                            }
                            //$scope.drawPaths();

                        });

                    }, function (error) {
                        alert('Unable to get location: ' + error.message);

                    }, 1000);
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });



        }
        $(function () {
            $(".back-button").click(function () {
                console.log(location.href);
                if (location.href.indexOf("#/1") > 0) {
                    $(".pane").css("background", "url(img/bg-01.png) no-repeat center center fixed");
                    $(".pane").css("background-size", "cover");
                }
            })
        })
        var module = angular.module('ionicApp', ['ionic', 'ionicApp.services']);
        module.run(function ($ionicPlatform) {
            $ionicPlatform.ready(function () {
                // Hide the accessory bar by default (remove this to show the accessory bar above the keyboard
                // for form inputs)


                document.addEventListener("resume", function () {

                    if (window.cordova && window.cordova.plugins.Keyboard) {
                        cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);
                    }
                    if (window.StatusBar) {
                        // org.apache.cordova.statusbar required
                        StatusBar.styleDefault();
                    }

                }, false);
            });
        });
        module.config(function ($stateProvider, $urlRouterProvider) {
                $stateProvider
                    .state('page1', {
                        url: '/1',
                        templateUrl: 'templates/home.html',
                        controller: "HomeCtrl"
                    })
                    .state('page2', {
                        url: '/2',
                        templateUrl: 'page2.html',
                        controller: "Page2Ctrl"
                    })
                    .state('page3', {
                        url: '/3',
                        templateUrl: 'page3.html',
                        controller: "Page3Ctrl"
                    })
                    .state('fst', {
                        url: '/fst',
                        templateUrl: 'templates/menu.html',
                        abstract: true,
                        controller: 'menuCtrl'
                    })

                .state('fst.list', {
                    url: '/list',
                    views: {
                        'fst': {
                            templateUrl: 'templates/list.html',
                            controller: 'listCtrl'
                        }
                    }
                })
                $urlRouterProvider.otherwise("/1");
            })
            .controller('menuCtrl', function ($scope, $ionicSideMenuDelegate, treePageService, $ionicPopup, $compile, $ionicLoading) {
                $scope.toggleLeft = function () {
                    $ionicSideMenuDelegate.toggleLeft();
                }
                $scope.$on("$ionicView.enter", function () {
                    init();
                    $scope.$digest();
                });

                function initialize() {
                    var myLatlng = new google.maps.LatLng(43.07493, -89.381388);
                    rmarker.clear();
                    var mapOptions = {
                        center: myLatlng,
                        zoom: 13,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };
                    map = new google.maps.Map(document.getElementById("map2"),
                        mapOptions);

                    //Marker + infowindow + angularjs compiled ng-click
                    var contentString = "<div><a ng-click='clickTest()'>Click me!</a></div>";
                    var compiled = $compile(contentString)($scope);

                    var infowindow = new google.maps.InfoWindow({
                        content: compiled[0]
                    });

                    var marker = new google.maps.Marker({
                        position: myLatlng,
                        map: map,
                        title: 'Uluru (Ayers Rock)'
                    });

                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.open(map, marker);
                    });
                    google.maps.event.addListener(map, 'click', function (e) { // duh! :-( google map zoom on double click!
                        if (!$(e.target).is('#wrapper_grid *')) {
                            $(".wrap_weather_box").remove();
                        }
                    });
                    $scope.map = map;
                    //  var f= getParam("from");
                    // if(f=="3")
                    //    {
                    navigator.geolocation.getCurrentPosition(function (pos) {
                        markers.clear();
                        var ll = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                        map.setCenter(ll);

                        var ltl = pos.coords.latitude + "," + pos.coords.longitude;
                        var contentString = "<div>You are here</div>";
                        var compiled = $compile(contentString)($scope);
                        $scope.createMarker(ll, contentString, "Here", "You are here");
                        $scope.createMarkers(mapLists);
                        //$scope.drawPaths();

                    }, function (error) {
                        alert('Unable to get location: ' + error.message);
                    }, {
                        maximumAge: 600000,
                        timeout: 5000,
                        enableHighAccuracy: true
                    });

                    // }
                    //    else{
                    //        $scope.centerOnMe();
                    //    }
                }

                function init() {
                    $("#loading").css("display", "block");
                    navigator.geolocation.getCurrentPosition(function (pos) {
                        //$scope.toggleLeft();
                        $ionicSideMenuDelegate.toggleLeft(true);
                        var ltl = pos.coords.latitude + "," + pos.coords.longitude;

                        var his = getParam('his');
                        var fun = getParam('fun');
                        var food = getParam('food');
                        var dis = getParam('distance');
                        treePageService.getPathBy(food, his, fun, ltl, dis).then(function (t) {

                            $scope.lists = t.$values;
                            lists = t.$values;
                            $("#loading").css("display", "none");
                            initialize();


                        });

                    }, function (error) {
                        alert('Unable to get location: ' + error.message);
                    });
                }
                init();
                $scope.lists = [];
                $scope.createMarkers = function (paths) {

                    for (var i = 0; i < paths.length; i++) {
                        var p = paths[i];
                        var myLatlng = new google.maps.LatLng(p.location.lat, p.location.lng);
                        markers.push(myLatlng);
                        var contentString = "<div><table><tr><td>Name</td><td>:</td><td>{0}</td></tr>".with(p.name);
                        contentString += "<tr><td>Adress</td><td>:</td><td>{0}</td></tr>".with(p.location.address == null ? "" : p.location.address);
                        contentString += "</table></div>";
                        var compiled = $compile(contentString)($scope);
                        $scope.createMarker(myLatlng, contentString, (i + 1).toString(), p.name);

                    }

                }
                $scope.createMarker = function (latlng, html, label, name) {

                    var marker = new MarkerWithLabel({
                        position: latlng,
                        draggable: true,
                        raiseOnDrag: true,
                        map: map,
                        name: name,
                        labelAnchor: new google.maps.Point(22, 0),
                        labelClass: "labels" // the CSS class for the label
                    });
                    rmarker.push(marker);
                    var infowindow = new google.maps.InfoWindow();
                    $scope.bindInfoWindow(marker, infowindow, html);
                }
                $scope.bindInfoWindow = function (marker, infowindow, html) {
                    marker.addListener('click', function () {
                        infowindow.setContent(html);
                        infowindow.open(map, this);
                    });
                }
            })
            .controller('NavController', function ($scope, $ionicSideMenuDelegate) {
                $scope.toggleLeft = function (e) {
                    e.preventDefault();
                    $ionicSideMenuDelegate.toggleLeft();
                }
                $scope.init = function () {
                    $ionicSideMenuDelegate.toggleLeft();
                }
                $scope.init();
            })
            .controller('listCtrl', function ($scope) {

            })
            .controller('HomeCtrl', function ($scope, $window) {

                //$scope.selectedFood={};
                $scope.selectedHistoric = {};
                $scope.selectedFun = {};
                $scope.dataFood = [
                    {
                        id: '',
                        text: 'None'
                                                                 },
                    {
                        id: '4bf58dd8d48988d142941735',
                        text: 'Asian Restaurant'
                                                                 },
                    {
                        id: '4bf58dd8d48988d111941735',
                        text: 'Japanese Restaurant'
                                                                 },
                    {
                        id: '4bf58dd8d48988d113941735',
                        text: 'Korean Restaurant'
                                                                 },
                    {
                        id: '4bf58dd8d48988d16a941735',
                        text: 'Bakery'
                                                                 },
                    {
                        id: '4bf58dd8d48988d16b941735',
                        text: 'Brazilian Restaurant'
                                                                 },
                    {
                        id: '4bf58dd8d48988d143941735',
                        text: 'Breakfast Spot'
                                                                 },
                    {
                        id: '4bf58dd8d48988d128941735',
                        text: 'Cafeteria'
                                                                 },
                    {
                        id: '4bf58dd8d48988d16d941735',
                        text: 'Caf√©'
                                                                 },
                    {
                        id: '4bf58dd8d48988d1e0931735',
                        text: 'Coffee Shop'
                                                                 },
                    {
                        id: '4bf58dd8d48988d1d0941735',
                        text: 'Dessert Shop'
                                                                 },
                    {
                        id: '4bf58dd8d48988d147941735',
                        text: 'Diner'
                                                                 },
                    {
                        id: '4bf58dd8d48988d10b941735',
                        text: 'Falafel Restaurant'
                                                                 },
                    {
                        id: '4bf58dd8d48988d16e941735',
                        text: 'Fast Food Restaurant'
                                                                 },
                    {
                        id: '4edd64a0c7ddd24ca188df1a',
                        text: 'Fish & Chips Shop'
                                                                 },
                    {
                        id: '4bf58dd8d48988d10c941735',
                        text: 'French Restaurant'
                                                                 },
                    {
                        id: '55d25775498e9f6a0816a37a',
                        text: 'Friterie'
                                                                 },
                    {
                        id: '4bf58dd8d48988d10e941735',
                        text: 'Greek Restaurant'
                                                                 },
                    {
                        id: '52e81612bcbc57f1066b79ff',
                        text: 'Halal Restaurant'
                                                                 },
                    {
                        id: '4bf58dd8d48988d10f941735',
                        text: 'Indian Restaurant'
                                                                 },
                    {
                        id: '4bf58dd8d48988d110941735',
                        text: 'Italian Restaurant'
                                                                 },
                    {
                        id: '4f04af1f2fb6e1c99f3db0bb',
                        text: 'Turkish Restaurant'
                                                                 },
                    {
                        id: '4bf58dd8d48988d1d3941735',
                        text: 'Vegetarian / Vegan Restaurant'
                                                                 },
                    {
                        id: '4d4b7105d754a06376d81259',
                        text: 'Nightlife Spot'
                                                                 },
                    {
                        id: '4d4b7105d754a06377d81259',
                        text: 'Outdoors & Recreation'
                                                                 }
                                                                 ];

                $scope.dataHistoric = [
                    {
                        id: '',
                        text: 'None'
                                                                     },
                    {
                        id: '4bf58dd8d48988d181941735',
                        text: 'Museum'
                                                                     },
                    {
                        id: '52e81612bcbc57f1066b7a22',
                        text: 'Botanical Garden'
                                                                     },
                    {
                        id: '50aaa49e4b90af0d42d5de11',
                        text: 'Castle'
                                                                     },
                    {
                        id: '52e81612bcbc57f1066b7a23',
                        text: 'Forest'
                                                                     },
                    {
                        id: '4bf58dd8d48988d15a941735',
                        text: 'Garden'
                                                                     },
                    {
                        id: '52e81612bcbc57f1066b7a21',
                        text: 'National Park'
                                                                     },
                    {
                        id: '52e81612bcbc57f1066b7a14',
                        text: 'Palace'
                                                                     },
                    {
                        id: '52e81612bcbc57f1066b7a29',
                        text: 'Rafting'
                                                                     },
                    {
                        id: '52e81612bcbc57f1066b7a3e',
                        text: 'Buddhist Temple'
                                                                     },
                    {
                        id: '4bf58dd8d48988d132941735',
                        text: 'Church'
                                                                     },
                    {
                        id: '52e81612bcbc57f1066b7a3f',
                        text: 'Hindu Temple'
                                                                     },
                    {
                        id: '52e81612bcbc57f1066b7a40',
                        text: 'Monastery'
                                                                     },
                    {
                        id: '4bf58dd8d48988d138941735',
                        text: 'Mosque'
                                                                     },
                    {
                        id: '4bf58dd8d48988d13a941735',
                        text: 'Temple'
                                                                     },
                    {
                        id: '4deefb944765f83613cdba6e',
                        text: 'Historic Site'
                                                                     }
                                                                     ];
                $scope.dataFun = [
                    {
                        id: '',
                        text: 'None'
                                                                },
                    {
                        id: '4bf58dd8d48988d17f941735',
                        text: 'Movie Theater'
                                                                },
                    {
                        id: '4bf58dd8d48988d17b941735',
                        text: 'Zoo'
                                                                },
                    {
                        id: '4fceea171983d5d06c3e9823',
                        text: 'Aquarium'
                                                                },
                    {
                        id: '52e81612bcbc57f1066b79e7',
                        text: 'Circus'
                                                                },
                    {
                        id: '4bf58dd8d48988d18e941735',
                        text: 'Comedy Club'
                                                                },
                    {
                        id: '52e81612bcbc57f1066b79ef',
                        text: 'Country Dance Club'
                                                                },
                    {
                        id: '4bf58dd8d48988d1e5931735',
                        text: 'Music Venue'
                                                                },
                    {
                        id: '4bf58dd8d48988d1fd941735',
                        text: 'Mall'
                                                                }
                                                                ];
                $scope.dataDistance = [1500, 3000, 5000];

                $scope.selectedFood = $scope.dataFood[1];
                $scope.selectedHistoric = $scope.dataHistoric[1];
                $scope.selectedFun = $scope.dataFun[1];
                $scope.selectedDistance = $scope.dataDistance[0];

                function initHome() {
                    $(".pane").css("background", "url(img/bg-01.png) no-repeat center center fixed");
                    $(".pane").css("background-size", "cover");
                }
                initHome();
                $scope.find = function () {
                    if (lists)
                        lists.clear();
                    //#/fst/list
                    location.href = "#/3?food=" + $(".js-example-placeholder-single").val().replace("string:", "") + "&his=" + $(".js-example-placeholder-single2").val().replace("string:", "") + "&fun=" + $(".js-example-placeholder-single3").val().replace("string:", "") + "&distance=" + $(".js-example-placeholder-single4").val().replace("number:", "");
                }

            })
            .controller('Page3Ctrl', function ($scope, treePageService, $ionicPopup) {
                $scope.showonMap = function () {
                    if ($("input[type='checkbox']:checked").length == 0) {
                        var alertPopup = $ionicPopup.alert({
                            title: 'Alert!',
                            template: 'Please select at least one of them'
                        });
                    } else {
                        mapLists.clear();


                        $("input[type='checkbox']:checked").each(function () {
                            var ind = lists.map(function (x) {
                                return x.id;
                            }).indexOf($(this).attr("id"));
                            mapLists.push(lists[ind]);
                            //lists.splice(ind,1);
                        })

                        // var tmp= JSON.stringify(lists);
                        location.href = "#/2?from=3";
                    }

                }

                function init() {
                    $(".pane").css("background", "url(img/bg-02.png) no-repeat center center fixed");
                    $(".pane").css("background-size", "cover");
                    $("#loading").css("display", "block");
                    $(".default-title").text("");
                    navigator.geolocation.getCurrentPosition(function (pos) {

                        var ltl = pos.coords.latitude + "," + pos.coords.longitude;

                        var his = getParam('his');
                        var fun = getParam('fun');
                        var food = getParam('food');
                        var dis = getParam('distance');
                        treePageService.getPathBy(food, his, fun, ltl, dis).then(function (t) {
                            //       var contentString = "<div>You are here</div>";
                            //var compiled = $compile(contentString)($scope);
                            //      $scope.createMarker(ll,contentString,"Here","You are here");
                            //    $scope.createMarkers(t);
                            //$scope.drawPaths();
                            $scope.lists = t.$values;
                            lists = t.$values;
                            $("#loading").css("display", "none");

                        });

                    }, function (error) {
                        alert('Unable to get location: ' + error.message);
                    });
                }
                init();
                $scope.lists = [];
            })
            .controller('Page2Ctrl', function ($scope, $ionicLoading, $compile, treePageService) {
                $scope.centerOnMe = function () {

                    navigator.geolocation.getCurrentPosition(function (pos) {
                        markers.clear();
                        var ll = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                        currentPos = ll;
                        map.setCenter(ll);
                        markers.push(ll);
                        var ltl = pos.coords.latitude + "," + pos.coords.longitude;
                        treePageService.getPaths(ltl).then(function (t) {
                            // lists=t;
                            var contentString = "<div>You are here</div>";
                            var compiled = $compile(contentString)($scope);
                            $scope.createMarker(ll, contentString, "Here", "You are here");
                            $scope.createMarkers(t.$values);
                            mapLists = t.$values;
                            //$scope.drawPaths();

                        });

                    }, function (error) {
                        alert('Unable to get location: ' + error.message);
                    });
                }

                function initialize() {
                    $(".default-title").text("");
                    var myLatlng = new google.maps.LatLng(43.07493, -89.381388);
                    rmarker.clear();
                    var mapOptions = {
                        center: myLatlng,
                        zoom: 13,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    };
                    map = new google.maps.Map(document.getElementById("map"),
                        mapOptions);

                    //Marker + infowindow + angularjs compiled ng-click
                    var contentString = "<div><a ng-click='clickTest()'>Click me!</a></div>";
                    var compiled = $compile(contentString)($scope);

                    var infowindow = new google.maps.InfoWindow({
                        content: compiled[0]
                    });

                    var marker = new google.maps.Marker({
                        position: myLatlng,
                        map: map,
                        title: 'Uluru (Ayers Rock)'
                    });

                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.open(map, marker);
                    });

                    $scope.map = map;
                    var f = getParam("from");
                    if (f == "3") {
                        navigator.geolocation.getCurrentPosition(function (pos) {
                            markers.clear();
                            var ll = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                            map.setCenter(ll);
                            markers.push(ll);
                            currentPos = ll;
                            var ltl = pos.coords.latitude + "," + pos.coords.longitude;
                            var contentString = "<div>You are here</div>";
                            var compiled = $compile(contentString)($scope);
                            $scope.createMarker(ll, contentString, "Here", "You are here");
                            $scope.createMarkers(mapLists);
                            //$scope.drawPaths();

                        }, function (error) {
                            alert('Unable to get location: ' + error.message);
                        });

                    } else {
                        $scope.centerOnMe();
                    }
                }
                initialize();
                // google.maps.event.addDomListener(window, 'load', initialize);
                $scope.drawPaths = function () {
                    for (var i = 0; i < markers.length; i++) {
                        if (i < markers.length - 1) {
                            $scope.createPath(markers[i], markers[i + 1]);
                        }
                    }
                }
                $scope.createPath = function (source, destination) {
                    var directionsDisplay = new google.maps.DirectionsRenderer({
                        suppressMarkers: true
                    });
                    var directionsService = new google.maps.DirectionsService;
                    directionsDisplay.setMap(map);

                    directionsService.route({
                        origin: {
                            lat: source.lat(),
                            lng: source.lng()
                        }, // Haight.
                        destination: {
                            lat: destination.lat(),
                            lng: destination.lng()
                        }, // Ocean Beach.
                        // Note that Javascript allows us to access the constant
                        // using square brackets and a string value as its
                        // "property."
                        travelMode: google.maps.TravelMode["WALKING"] //google.maps.TravelMode.WALKING
                    }, function (response, status) {
                        if (status == google.maps.DirectionsStatus.OK) {
                            directionsDisplay.setDirections(response);
                        } else {
                            window.alert('Directions request failed due to ' + status);
                        }
                    });
                }
                $scope.setRoute = function (ind) {
                    alert(ind);
                    treePageService.getPaths(ltl).then(function (t) {
                        // lists=t;
                        var contentString = "<div>You are here</div>";
                        var compiled = $compile(contentString)($scope);
                        $scope.createMarker(ll, contentString, "Here", "You are here");
                        $scope.createMarkers(t.$values);
                        //$scope.drawPaths();

                    });
                }
                $scope.createMarkers = function (paths) {

                    for (var i = 0; i < paths.length; i++) {
                        var p = paths[i];
                        var myLatlng = new google.maps.LatLng(p.location.lat, p.location.lng);
                        markers.push(myLatlng);
                        var contentString = "<div style='width:205px;height:132px'><p class='inf-name'>{0}</p>".with(p.name);
                        contentString += "<p class='inf-name'>{0}</p>".with(p.location.address == null ? "" : p.location.address);
                        contentString += "<div  style='margin:10px 0 10px 0'><p style='color: #6F6F6F;font-size: 15px;font-family:quicksand-Regular'>Which one prefer:</p></div>"
                        contentString += "<div><div style='display:inline-block;'><span mode='DRIVING' onclick='setActive(this)' style='font-size:28px;' class='ion-model-s i-dircect active-direct'></span></div>";
                        contentString += "<div style='display:inline-block;margin-left:25px'><span mode='WALKING' onclick='setActive(this)' style='font-size:28px;color:#ccc' class='ion-android-walk i-dircect'></span></div>";
                        contentString += "<div style='display:inline-block;margin-left:25px'><button style='background-color:#2e8db2;color:#fff;border-radius: 15px;position: relative;top: -15px;font-size: 13px !important;' class='button button-small button-stable' onclick='setRoute({0})'>Get Direction</button></div></div>".with(i);
                        var compiled = $compile(contentString)($scope);
                        $scope.createMarker(myLatlng, contentString, (i + 1).toString(), p.name, p);

                    }

                }
                $scope.createMarker = function (latlng, html, label, name, p) {
                    //      var marker = new google.maps.Marker({
                    //              position: latlng,
                    //          map: map,
                    //              label:label,
                    //  title: name,
                    //          labelContent: "$425K",
                    //labelAnchor: new google.maps.Point(22, 0),
                    //   labelClass: "labels", // the CSS class for the label
                    //labelStyle: {opacity: 0.75}

                    //       });
                    var opt = {};
                    if (p) {
                        opt = {
                            position: latlng,
                            draggable: false,
                            raiseOnDrag: true,
                            map: map,
                            name: name,
                            labelAnchor: new google.maps.Point(22, 0),
                            labelClass: "labels", // the CSS class for the label
                            icon: "img/" + p.categoryName + ".png"
                        };
                    } else {
                        opt = {
                            position: latlng,
                            draggable: false,
                            raiseOnDrag: true,
                            map: map,
                            name: name,
                            labelAnchor: new google.maps.Point(22, 0),
                            labelClass: "labels" // the CSS class for the label

                        };
                    }

                    var marker = new MarkerWithLabel(opt);
                    rmarker.push(marker);
                    var infowindow = new google.maps.InfoWindow();
                    $scope.bindInfoWindow(marker, infowindow, html);
                }
                $scope.bindInfoWindow = function (marker, infowindow, html) {
                    marker.addListener('click', function () {
                        infowindow.setContent(html);
                        infowindow.open(map, this);
                    });
                }


                $scope.clickTest = function () {
                    alert('Example of infowindow with ng-click')
                };

            })
    </script>

    <!-- 
         <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
         <script src="js/index.js"></script>
         -->

    <script src="js/service.js?v=1.1"></script>
</body>

</html>